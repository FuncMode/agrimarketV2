<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyer Dashboard - AgriMarket</title>
  
  <!-- Security Headers (set via nginx/server, not meta tags) -->
  <meta name="referrer" content="strict-origin-when-cross-origin">
  
  <!-- DNS Prefetch & Preconnect -->
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://unpkg.com">
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  
  <!-- Preload Critical CSS -->
  <link rel="preload" href="/assets/css/main.css" as="style">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <link rel="stylesheet" href="/assets/css/utilities.css">
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' 1.75fill='%2328a745'>ðŸŒ¾</t
    
    @media (min-width: 769px) {
      .navbar-link {
        padding: 0.5rem 0.5rem !important;
      }
    }
    
    @media (max-width: 1024px) {
      .navbar-menu {
        gap: 0.5rem !important;
      }
      
      .navbar-link {
        padding: 0.375rem 0.4rem !important;
        font-size: 0.875rem !important;
      }
    }ext></svg>">
</head>
<body class="bg-light">
  
  <!-- Navbar -->
  <nav id="main-navbar" class="navbar">
    <!-- Rendered by navbar.js -->
  </nav>
  
  <!-- Main Container -->
  <div class="container mx-auto px-4 py-4 sm:py-6 md:py-8">
    
    <!-- Browse Section -->
    <section id="browse" class="mb-8 sm:mb-12">
      <!-- Header with Title and View Toggle -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3">
        <div>
          <h2 class="text-2xl sm:text-3xl font-bold">Browse Products</h2>
          <p class="text-sm text-gray-600 mt-1">Discover fresh produce from verified farmers and fishermen in Rizal</p>
        </div>
      </div>
      
      <!-- Main Browse Layout -->
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Filters Sidebar -->
        <aside class="lg:w-64 flex-shrink-0">
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 sticky top-4">
            <!-- Filters Header -->
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
              <h3 class="font-bold text-lg flex items-center gap-2">
                <i class="bi bi-funnel"></i> Filters
              </h3>
              <button id="clear-filters" class="text-sm text-primary hover:text-primary-light">
                Clear
              </button>
            </div>
            
            <!-- Filters Content -->
            <div class="p-4 space-y-4">
              <!-- Search -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="bi bi-search"></i> Search
                </label>
                <input 
                  type="text" 
                  id="browse-search" 
                  placeholder="Search products, sellers..." 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                >
              </div>
              
              <!-- Category -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                <select id="browse-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                  <option value="">All Categories</option>
                  <option value="vegetables">Vegetables</option>
                  <option value="fruits">Fruits</option>
                  <option value="fish_seafood">Fish & Seafood</option>
                  <option value="meat_poultry">Meat & Poultry</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <!-- Municipality -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="bi bi-geo-alt"></i> Municipality
                </label>
                <select id="browse-municipality" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                  <option value="">All Locations</option>
                </select>
              </div>
              
              <!-- Product Tags -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Product Tags</label>
                <div class="space-y-2">
                  <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                    <input type="checkbox" id="tag-fresh" value="fresh" class="product-tag-checkbox rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="text-sm">Fresh</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                    <input type="checkbox" id="tag-organic" value="organic" class="product-tag-checkbox rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="text-sm">Organic</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                    <input type="checkbox" id="tag-recently-harvested" value="recently_harvested" class="product-tag-checkbox rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="text-sm">Recently Harvested</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </aside>
        
        <!-- Products Content Area -->
        <div class="flex-1 min-w-0">
          <!-- Top Bar with Results Count, Sort, and View Toggle -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
            <div class="flex items-center gap-2">
              <span id="products-count" class="font-medium text-gray-700">0 products found</span>
            </div>
            
            <div class="flex items-center gap-3 w-full sm:w-auto">
              <!-- Sort -->
              <select id="browse-sort" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm flex-1 sm:flex-initial">
                <option value="created_at:desc">Newest First</option>
                <option value="price_per_unit:asc">Price: Low to High</option>
                <option value="price_per_unit:desc">Price: High to Low</option>
                <option value="view_count:desc">Most Viewed</option>
                <option value="name:asc">Name: A to Z</option>
              </select>
              
              <!-- View Toggle -->
              <div class="flex border border-gray-300 rounded-lg overflow-hidden">
                <button 
                  id="view-grid" 
                  class="p-2 hover:bg-gray-50 view-toggle active" 
                  data-view="grid"
                  title="Grid View"
                >
                  <i class="bi bi-grid-3x3-gap"></i>
                </button>
                <button 
                  id="view-map" 
                  class="p-2 hover:bg-gray-50 view-toggle border-l border-gray-300" 
                  data-view="map"
                  title="Map View"
                >
                  <i class="bi bi-map"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Products Grid -->
          <div id="browse-products" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
            <!-- Products rendered by JS -->
          </div>
          
          <!-- Map View (Hidden by default) -->
          <div id="browse-map-container" class="hidden">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
              <div id="browse-map" class="w-full h-[600px]"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Cart Section -->
    <section id="cart" class="mb-8 sm:mb-12">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6">Shopping Cart</h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
        <!-- Cart Items -->
        <div class="lg:col-span-2 order-2 lg:order-1">
          <div id="cart-items" class="space-y-3 sm:space-y-4">
            <!-- Cart items rendered by JS -->
          </div>
        </div>
        
        <!-- Cart Summary -->
        <div class="order-1 lg:order-2">
          <div class="card sticky top-4">
            <div class="card-body">
              <h3 class="text-lg sm:text-xl font-bold mb-4">Order Summary</h3>
              <div class="space-y-2 mb-4">
                <div class="flex justify-between text-sm sm:text-base">
                  <span>Subtotal:</span>
                  <span id="cart-subtotal">â‚±0.00</span>
                </div>
                <div class="flex justify-between font-bold text-base sm:text-lg border-t pt-2">
                  <span>Total:</span>
                  <span id="cart-total">â‚±0.00</span>
                </div>
              </div>
              <button id="btn-checkout" class="btn btn-primary w-full text-sm sm:text-base">
                <i class="bi bi-bag-check"></i> Proceed to Checkout
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Orders Section -->
    <section id="orders" class="mb-8 sm:mb-12">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6">My Orders</h2>
      
      <!-- Order Filters -->
      <div class="flex gap-4 mb-6 flex-wrap">
        <button class="btn btn-outline order-filter active" data-status="all">All</button>
        <button class="btn btn-outline order-filter" data-status="pending">Pending</button>
        <button class="btn btn-outline order-filter" data-status="confirmed">Confirmed</button>
        <button class="btn btn-outline order-filter" data-status="ready">Ready</button>
        <button class="btn btn-outline order-filter" data-status="completed">Completed</button>
        <button class="btn btn-outline order-filter" data-status="cancelled">Cancelled</button>
      </div>
      
      <!-- Orders List -->
      <div id="orders-list" class="space-y-4">
        <!-- Orders rendered by JS -->
      </div>
    </section>
    
    <!-- My Issues Section -->
    <section id="my-issues" class="mb-8 sm:mb-12">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6">My Issues</h2>
      
      <!-- Issue Filters -->
      <div class="flex gap-4 mb-6 flex-wrap">
        <button class="btn btn-outline issue-filter active" data-status="all">All</button>
        <button class="btn btn-outline issue-filter" data-status="under_review">Under Review</button>
        <button class="btn btn-outline issue-filter" data-status="resolved">Resolved</button>
        <button class="btn btn-outline issue-filter" data-status="rejected">Rejected</button>
      </div>
      
      <!-- Issues List -->
      <div id="issues-list" class="space-y-4">
        <!-- Issues rendered by JS -->
      </div>
    </section>
    
    <!-- Messaging Section -->
    <section id="messaging" class="mb-8 sm:mb-12">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6">Messages</h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Conversations List -->
        <div class="lg:col-span-1">
          <div class="card">
            <div class="card-body">
              <h3 class="text-lg font-bold mb-4">Conversations</h3>
              <div id="conversations-list">
                <!-- Conversations rendered by JS -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Chat Window -->
        <div class="lg:col-span-2">
          <div class="card">
            <div class="card-body">
              <div id="chat-window">
                <p class="text-center text-gray-500 py-12">Select a conversation to start messaging</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
  </div>
  
  <!-- Product Details Modal -->
  <div id="product-details-modal" class="modal-backdrop hidden">
    <div class="product-details-modal">
      <div class="product-details-header">
        <h2 id="product-details-title" class="text-2xl font-bold">Product Details</h2>
        <button id="close-product-modal" class="btn-close">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      
      <div class="product-details-content">
        <!-- Map Section -->
        <div class="product-map-section">
          <div id="product-map" class="product-map"></div>
          <div class="distance-info">
            <div id="distance-display" class="distance-card">
              <i class="bi bi-geo-alt"></i> Calculating distance...
            </div>
          </div>
        </div>
        
        <!-- Product Details Section -->
        <div class="product-info-section" id="product-info-content">
          <!-- Product details will be populated here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div id="toast-container"></div>
  
  <!-- Leaflet Map Library -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous" defer></script>
  
  <!-- Socket.io Client Library -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI" crossorigin="anonymous" defer></script>
  
  <script src="/assets/js/config/env-loader.js"></script>
  
  <!-- Performance & Security -->
  <script type="module">
    import { initPerformanceMonitoring } from '/assets/js/utils/performance-monitor.js';
    import { initLazyLoading } from '/assets/js/utils/lazy-loader.js';
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      initPerformanceMonitoring();
    }
    initLazyLoading();
  </script>
  
  <script type="module" src="/assets/js/pages/buyer.main.js"></script>
</body>
</html>